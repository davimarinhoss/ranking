<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard de Performance - Closers</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
        --bg-gradient-start: #0f1419;
        --bg-gradient-end: #1a202e;
        --text-primary: #e0e6ed;
        --text-secondary: #8c9cb0;
        --card-bg: rgba(29, 38, 53, 0.85);
        --card-border: rgba(255, 255, 255, 0.08);
        --highlight-gold: #ffd700;
        --highlight-gold-shadow: rgba(255, 215, 0, 0.5);
        --highlight-silver: #c0c0c0;
        --highlight-silver-shadow: rgba(192, 192, 192, 0.4);
        --highlight-bronze: #cd7f32;
        --highlight-bronze-shadow: rgba(205, 127, 50, 0.4);
        --highlight-blue: #4299e1;
        --highlight-blue-rgb: 66, 153, 225;
        --highlight-blue-light: #63b3ed;
        --highlight-green: #48bb78;
        --highlight-green-light: #68d391;
        --font-main: "Inter", sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-main);
        background: linear-gradient(
          135deg,
          var(--bg-gradient-start) 0%,
          var(--bg-gradient-end) 100%
        );
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      .filters-bar {
        background-color: rgba(29, 38, 53, 0.7);
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        border: 1px solid var(--card-border);
      }
      .filters-bar label {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text-secondary);
      }
      .filters-bar .dropdown {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-color: rgba(0, 0, 0, 0.25);
        border: 1px solid var(--card-border);
        border-radius: 8px;
        padding: 0.6rem 2.2rem 0.6rem 0.8rem;
        color: var(--text-primary);
        font-size: 0.9rem;
        font-family: var(--font-main);
        cursor: pointer;
        transition: border-color 0.3s ease, background-color 0.3s ease;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238c9cb0'%3E%3Cpath d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 0.6rem center;
        background-size: 1.1em;
        min-width: 200px;
      }
      .filters-bar .dropdown option {
        background-color: var(--bg-gradient-end);
        color: var(--text-primary);
      }
      .filters-bar .dropdown:hover {
        border-color: var(--highlight-blue);
      }
      .filters-bar .dropdown:focus {
        outline: none;
        border-color: var(--highlight-blue-light);
      }

      .podium-section {
        margin-bottom: 3rem;
        padding: 2rem 0;
        border-bottom: 1px solid var(--card-border);
      }
      .podium-title {
        font-size: 2rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 2.5rem;
        background: linear-gradient(135deg, #f0f0f0, #b0c0d0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
      }
      .podium-container {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 1rem;
        min-height: 340px;
      }
      .podium-item {
        background: var(--card-bg);
        border: 1px solid var(--card-border);
        border-radius: 12px;
        padding: 1.5rem 1rem;
        text-align: center;
        width: 200px;
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        position: relative;
      }
      .podium-closer-photo {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        border: 4px solid transparent;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
        transition: transform 0.3s ease;
        overflow: hidden;
        background-color: var(--bg-gradient-start);
      }
      .podium-closer-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }
      .podium-item:hover .podium-closer-photo {
        transform: scale(1.05);
      }
      .podium-item .rank {
        font-size: 2.5rem;
        font-weight: 700;
        line-height: 1;
        margin-bottom: 0.5rem;
      }
      .podium-item .name {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
      }
      .podium-item .sales {
        font-size: 1.2rem;
        font-weight: 500;
        color: var(--highlight-green);
      }

      .podium-item.first {
        height: 330px;
        border-top: 5px solid var(--highlight-gold);
      }
      .podium-item.first .podium-closer-photo {
        border-color: var(--highlight-gold);
        box-shadow: 0 0 20px var(--highlight-gold-shadow),
          0 5px 15px rgba(0, 0, 0, 0.25);
      }
      .podium-item.first .rank {
        color: var(--highlight-gold);
      }

      .podium-item.second {
        height: 290px;
        border-top: 5px solid var(--highlight-silver);
      }
      .podium-item.second .podium-closer-photo {
        border-color: var(--highlight-silver);
        box-shadow: 0 0 15px var(--highlight-silver-shadow),
          0 5px 15px rgba(0, 0, 0, 0.25);
      }
      .podium-item.second .rank {
        color: var(--highlight-silver);
      }

      .podium-item.third {
        height: 250px;
        border-top: 5px solid var(--highlight-bronze);
      }
      .podium-item.third .podium-closer-photo {
        border-color: var(--highlight-bronze);
        box-shadow: 0 0 12px var(--highlight-bronze-shadow),
          0 5px 15px rgba(0, 0, 0, 0.25);
      }
      .podium-item.third .rank {
        color: var(--highlight-bronze);
      }

      .header {
        text-align: center;
        margin-bottom: 2.5rem;
        position: relative;
      }
      .header::before {
        content: "";
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 5px;
        background: linear-gradient(90deg, var(--highlight-gold), #ffed4e);
        border-radius: 3px;
        box-shadow: 0 0 15px var(--highlight-gold-shadow);
      }
      .header h1 {
        font-size: 2.8rem;
        font-weight: 700;
        background: linear-gradient(135deg, #f0f0f0, #b0c0d0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-fill-color: transparent;
        margin-bottom: 0.75rem;
        letter-spacing: -0.5px;
      }
      .header p {
        color: var(--text-secondary);
        font-size: 1.15rem;
        font-weight: 400;
        max-width: 600px;
        margin: 0 auto;
      }

      .dashboard-grid {
        display: grid;
        gap: 2.5rem;
        margin-bottom: 2rem;
        grid-template-columns: 1fr;
      }

      @media (min-width: 840px) {
        .dashboard-grid {
          grid-template-columns: 1fr 1fr;
        }
      }

      .card {
        background: var(--card-bg);
        backdrop-filter: blur(12px);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
        transition: transform 0.3s ease, box-shadow 0.3s ease,
          border-color 0.3s ease;
        display: flex;
        flex-direction: column;
      }
      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.35);
        border-color: rgba(var(--highlight-blue-rgb), 0.4);
      }
      .card-title {
        font-size: 1.6rem;
        font-weight: 600;
        margin-bottom: 1.8rem;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .card-title .icon {
        font-size: 1.5rem;
        line-height: 1;
        color: var(--highlight-blue);
      }
      .card-title::before {
        content: "";
        width: 5px;
        height: 24px;
        background: linear-gradient(
          180deg,
          var(--highlight-blue),
          var(--highlight-blue-light)
        );
        border-radius: 3px;
      }

      .chart-card-full-width {
        grid-column: 1 / -1;
      }
      /* Styles for the new table */
      .evolution-table-container {
        margin-top: 1.5rem; /* Space between chart and table */
        overflow-x: auto; /* For responsiveness on smaller screens */
      }
      .evolution-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.9rem;
      }
      .evolution-table th,
      .evolution-table td {
        padding: 0.75rem 1rem;
        text-align: left;
        border-bottom: 1px solid var(--card-border);
      }
      .evolution-table th {
        background-color: rgba(0, 0, 0, 0.2);
        color: var(--text-secondary);
        font-weight: 600;
      }
      .evolution-table td {
        color: var(--text-primary);
      }
      .evolution-table tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.03);
      }
      .evolution-table td.currency,
      .evolution-table td.na-value {
        text-align: right;
      }
      .evolution-table td.na-value {
        color: var(--text-secondary);
        font-style: italic;
      }

      .ranking-item {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
        padding: 0.75rem 0.5rem;
        border-radius: 12px;
        transition: background-color 0.3s ease;
        position: relative;
        animation: fadeIn 0.6s ease forwards;
        opacity: 0;
      }
      .ranking-item:nth-child(1) {
        animation-delay: 0.1s;
      }
      .ranking-item:nth-child(2) {
        animation-delay: 0.2s;
      }
      .ranking-item:nth-child(3) {
        animation-delay: 0.3s;
      }
      .ranking-item:nth-child(4) {
        animation-delay: 0.4s;
      }
      .ranking-item:nth-child(5) {
        animation-delay: 0.5s;
      }
      .ranking-item:hover {
        background-color: rgba(255, 255, 255, 0.03);
      }
      .ranking-position {
        font-size: 1.1rem;
        font-weight: 700;
        width: 35px;
        text-align: center;
        margin-right: 1rem;
        color: var(--text-secondary);
      }
      .top-1 .ranking-position {
        color: var(--highlight-gold);
        text-shadow: 0 0 12px var(--highlight-gold-shadow);
        font-size: 1.3rem;
      }

      .closer-photo {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        border: 2px solid transparent;
        transition: all 0.3s ease;
        overflow: hidden;
        background-color: var(--bg-gradient-start);
      }
      .closer-photo img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }
      .ranking-item:hover .closer-photo {
        border-color: var(--highlight-blue-light);
      }
      .top-1 .closer-photo {
        box-shadow: 0 0 15px var(--highlight-gold-shadow);
        border-color: var(--highlight-gold);
      }

      .closer-info {
        flex: 1;
        min-width: 0;
      }
      .closer-name {
        font-weight: 500;
        font-size: 1rem;
        margin-bottom: 0.35rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
      .progress-wrapper {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .progress-container {
        background: rgba(0, 0, 0, 0.35);
        height: 10px;
        border-radius: 5px;
        overflow: hidden;
        position: relative;
        flex: 1;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--highlight-blue),
          var(--highlight-blue-light)
        );
        border-radius: 5px;
        transition: width 1s cubic-bezier(0.25, 0.1, 0.25, 1);
        position: relative;
      }
      .top-1 .progress-bar {
        background: linear-gradient(90deg, var(--highlight-gold), #ffed4e);
      }
      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: -150%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.25),
          transparent
        );
        animation: shimmer 2.5s infinite;
      }
      .percentage {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text-secondary);
        min-width: 40px;
        text-align: right;
      }

      .individual-section {
        text-align: center;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
      }
      .closer-selector {
        margin-bottom: 1.5rem;
        position: relative;
      }
      .closer-selector .dropdown {
        width: 100%;
        max-width: 320px;
        margin: 0 auto;
        padding: 0.8rem 2.5rem 0.8rem 1rem;
        font-size: 1rem;
      }
      .selected-closer-display {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding-top: 1rem;
        min-height: 300px;
      }

      #selectedPhoto {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1rem;
        box-shadow: 0 6px 18px rgba(var(--highlight-blue-rgb), 0.35);
        animation: pulse 2.2s infinite ease-in-out;
        overflow: hidden;
        background-color: var(--bg-gradient-start);
      }
      #selectedPhoto img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
      }
      .selected-name {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-primary);
      }

      .circular-progress-display {
        position: relative;
        width: 180px;
        height: 180px;
        margin: 1rem auto 1.5rem auto;
      }
      .circular-progress-display svg {
        width: 100%;
        height: 100%;
        display: block;
      }
      .circular-progress-text-wrapper {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }
      .circular-progress-value {
        font-size: 1rem; /* REDUCED FONT SIZE */
        font-weight: 700;
        color: var(--text-primary);
        line-height: 1;
      }
      .circular-progress-label {
        font-size: 0.5rem; /* REDUCED FONT SIZE */
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-top: 4px;
      }
      .circular-progress-track {
        fill: none;
        stroke: rgba(0, 0, 0, 0.3);
      }
      .circular-progress-fill {
        fill: none;
        stroke-linecap: round;
        transition: stroke-dashoffset 1.5s cubic-bezier(0.42, 0, 0.58, 1);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-top: 1.5rem;
        max-width: 420px;
        margin-left: auto;
        margin-right: auto;
      }
      .stat-item {
        background: rgba(0, 0, 0, 0.15);
        padding: 1rem;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        text-align: center;
      }
      .stat-value {
        font-size: 1.6rem;
        font-weight: 700;
        color: var(--highlight-green);
        margin-bottom: 0.35rem;
        line-height: 1.2;
      }
      #salesCountValue.stat-value {
        color: var(--highlight-blue-light);
      }
      #averageTicketValue.stat-value {
        color: var(--highlight-gold);
      }
      .stat-label {
        font-size: 0.85rem;
        color: var(--text-secondary);
      }
      .empty-data-message {
        text-align: center;
        color: var(--text-secondary);
        font-style: italic;
        padding: 2rem;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes shimmer {
        0% {
          left: -150%;
        }
        100% {
          left: 150%;
        }
      }
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 6px 18px rgba(var(--highlight-blue-rgb), 0.35);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 8px 25px rgba(var(--highlight-blue-rgb), 0.45);
        }
      }

      @media (max-width: 992px) {
        .podium-container {
          flex-direction: column;
          align-items: center;
          gap: 1.5rem;
          min-height: auto;
        }
        .podium-item.second {
          order: 1;
        }
        .podium-item.first {
          order: 0;
        }
        .podium-item.third {
          order: 2;
        }
        .podium-item {
          width: 80%;
          max-width: 300px;
          height: auto !important;
          padding: 1rem;
          border-radius: 12px;
        }
        .podium-closer-photo {
          width: 60px;
          height: 60px;
          margin-bottom: 0.75rem;
        }
        .podium-closer-photo img {
          font-size: 0;
        }
        .podium-item .rank {
          font-size: 2rem;
        }
        .podium-item .name {
          font-size: 1rem;
        }
        .podium-item .sales {
          font-size: 1.1rem;
        }
        .filters-bar {
          flex-direction: column;
          align-items: stretch;
        }
        .filters-bar .dropdown {
          width: 100%;
        }
      }
      @media (max-width: 839px) {
        .header h1 {
          font-size: 2.2rem;
        }
        .header p {
          font-size: 1rem;
        }
        .container {
          padding: 1.5rem;
        }
        .card {
          padding: 1.5rem;
          border-radius: 20px;
        }
        .card-title {
          font-size: 1.4rem;
        }
        .circular-progress-display {
          width: 160px;
          height: 160px;
        }
        .circular-progress-value {
          font-size: 1.4rem;
        }
        .circular-progress-label {
          font-size: 0.65rem;
        }
        .stats-grid {
          gap: 0.75rem;
          grid-template-columns: 1fr 1fr;
          max-width: 300px;
        }
        .stats-grid .stat-item:last-child {
          grid-column: span 2;
        }
        .stat-value {
          font-size: 1.4rem;
        }
        .podium-title {
          font-size: 1.8rem;
        }
        .podium-item {
          width: 70%;
          max-width: 280px;
        }
      }
      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.8rem;
        }
        .header p {
          font-size: 0.9rem;
        }
        .container {
          padding: 1rem;
        }
        .card-title {
          font-size: 1.25rem;
          gap: 0.5rem;
          margin-bottom: 1.2rem;
        }
        .card-title::before {
          height: 20px;
          width: 4px;
        }
        .closer-name {
          font-size: 0.95rem;
        }
        .progress-container {
          height: 8px;
        }
        .closer-selector .dropdown {
          font-size: 0.9rem;
          padding: 0.7rem 2.2rem 0.7rem 0.8rem;
        }
        #selectedPhoto {
          width: 70px;
          height: 70px;
        }
        #selectedPhoto img {
          font-size: 0;
        }
        .selected-name {
          font-size: 1.1rem;
        }
        .circular-progress-display {
          width: 130px;
          height: 130px;
        }
        .circular-progress-value {
          font-size: 1.2rem;
        }
        .circular-progress-label {
          font-size: 0.6rem;
        }
        .stats-grid {
          grid-template-columns: 1fr;
          max-width: 200px;
        }
        .stats-grid .stat-item:last-child {
          grid-column: span 1;
        }
        .stat-value {
          font-size: 1.3rem;
        }
        .stat-label {
          font-size: 0.8rem;
        }
        .podium-title {
          font-size: 1.5rem;
          margin-bottom: 1.5rem;
        }
        .podium-item {
          width: 90%;
        }
        .podium-closer-photo {
          width: 50px;
          height: 50px;
          border-width: 3px;
        }
        .podium-closer-photo img {
          font-size: 0;
        }
        .closer-photo {
          width: 40px;
          height: 40px;
        }
        .closer-photo img {
          font-size: 0;
        }
        .evolution-table {
          font-size: 0.8rem;
        }
        .evolution-table th,
        .evolution-table td {
          padding: 0.5rem;
        }
      }
      /* Estilo para a primeira frase (pode ser adicionado na tag <style> se preferir) */
.subtle-question {
  font-size: 0.8rem;
  color: var(--text-secondary);
  text-align: left;
  margin-bottom: 0.5rem;
  font-style: italic;
}

.action-prompt {
  font-size: 0.9rem;
  color: var(--text-primary);
  text-align: left;
}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="filters-bar">
        <label for="dateFilter">Selecionar Período:</label>
        <select id="dateFilter" class="dropdown"></select>
      </div>

      <div class="podium-section">
        <h2 class="podium-title">Pódio de Vendas</h2>
        <div id="podium-container" class="podium-container"></div>
      </div>

      <div class="header">
        <h1>Dashboard de Performance</h1>
        <p>Acompanhe o desempenho dos nossos top closers em tempo real</p>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <h2 class="card-title">
            <span class="icon">🏆</span> Ranking Top Closers
          </h2>
          <div id="ranking-container"></div>
        </div>

        <div class="card">
          <h2 class="card-title">
            <span class="icon">📊</span> Performance Individual
          </h2>
          <div class="individual-section">
            <div class="closer-selector">
              <select id="closerSelect" class="dropdown">
                <option value="">Selecione um closer</option>
              </select>
            </div>
            <div
              id="selectedCloserInfo"
              class="selected-closer-display"
              style="display: none"
            >
              <div id="selectedPhoto" class="selected-photo"></div>
              <div id="selectedName" class="selected-name"></div>

              <div class="circular-progress-display">
                <svg viewBox="0 0 100 100">
                  <defs>
                    <linearGradient
                      id="circularProgressGradient"
                      x1="0%"
                      y1="0%"
                      x2="100%"
                      y2="0%"
                    >
                      <stop offset="0%" stop-color="var(--highlight-green)" />
                      <stop
                        offset="50%"
                        stop-color="var(--highlight-green-light)"
                      />
                      <stop offset="100%" stop-color="var(--highlight-blue)" />
                    </linearGradient>
                  </defs>
                  <circle
                    class="circular-progress-track"
                    cx="50"
                    cy="50"
                    r="42"
                    stroke-width="10"
                  />
                  <circle
                    id="individualPerformanceCircleFill"
                    class="circular-progress-fill"
                    cx="50"
                    cy="50"
                    r="42"
                    stroke-width="10"
                    transform="rotate(-90 50 50)"
                    stroke-dasharray="263.8937829"
                    stroke-dashoffset="263.8937829"
                    stroke="url(#circularProgressGradient)"
                  />
                </svg>
                <div class="circular-progress-text-wrapper">
                  <div
                    id="individualPerformanceValue"
                    class="circular-progress-value"
                  >
                    R$ 0
                  </div>
                  <div
                    id="individualPerformanceLabel"
                    class="circular-progress-label"
                  >
                    Faturamento
                  </div>
                </div>
              </div>

              <div class="stats-grid">
                <div class="stat-item">
                  <div id="currentResult" class="stat-value">R$ 0</div>
                  <div class="stat-label">Resultados</div>
                </div>
                <div class="stat-item">
                  <div id="salesCountValue" class="stat-value">0</div>
                  <div id="salesCountLabel" class="stat-label">Vendas</div>
                </div>
                <div class="stat-item">
                  <div id="averageTicketValue" class="stat-value">R$ 0</div>
                  <div class="stat-label">Ticket Médio</div>
                </div>
              </div>
            </div>
            <div
              id="noIndividualDataMessage"
              class="empty-data-message"
              style="display: none"
            >
              Nenhum dado disponível para este closer no período selecionado.
            </div>
          </div>
        </div>

        <div class="card chart-card-full-width">
          <h2 class="card-title">
            <span class="icon">📈</span> Evolução: Meta Mensal vs Faturamento
          </h2>
          <div
            class="chart-container"
            style="position: relative; height: 350px; width: 100%"
          >
            <canvas id="monthlyTargetEvolutionChart"></canvas>
          </div>
          <div id="evolutionTableContainer" class="evolution-table-container">
            <table class="evolution-table">
                <thead>
                    <tr>
                        <th>Mês</th>
                        <th>Meta Mensal Adaptada</th>
                        <th>Faturamento Mensal Realizado</th>
                        <th>Meta Ideal</th>
                    </tr>
                </thead>
                <tbody id="evolutionTableBody">
                    </tbody>
            </table>
          </div>
          <div style="margin-top: 1rem; padding: 0 1rem;">
            <p style="font-size: 0.8rem; color: var(--text-secondary); text-align: left; margin-bottom: 0.5rem;">
              <em>O que são as Metas Adaptadas?</em>
            </p>
            <p style="font-size: 0.9rem; color: var(--text-primary); text-align: left;">
              O que precisamos fazer agora já que não batemos as metas nos meses passados.
            </p>
          </div>
        </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- DATA ---
      const closersInfo = {
        cfn: {
          name: "Caio Ferreira Nascimento",
          initials: "CF",
          targetSalesCount: 20,
          imageUrl:
            "https://i.postimg.cc/ryBWdNyV/Captura-de-Tela-2025-06-02-a-s-11-11-56.png",
        },
        ba: {
          name: "Bruna Amorim",
          initials: "BA",
          targetSalesCount: 20,
          imageUrl:
            "https://i.postimg.cc/VvrvRv1Q/Whats-App-Image-2025-06-02-at-12-00-39.jpg",
        },
        bf: {
          name: "Bruna Ferreira",
          initials: "BF",
          targetSalesCount: 18,
          imageUrl:
            "https://i.postimg.cc/1tywzmyp/Captura-de-Tela-2025-06-02-a-s-11-10-25.png",
        },
        ri: {
          name: "Ricardo",
          initials: "RI",
          targetSalesCount: 15,
          imageUrl:
            "https://i.postimg.cc/kX5rbKTH/Captura-de-Tela-2025-06-02-a-s-11-12-40.png",
        },
        gm: {
          name: "Gabriel Miranda",
          initials: "GM",
          targetSalesCount: 18,
          imageUrl:
            "https://i.postimg.cc/NG3Ckn7Z/Captura-de-Tela-2025-06-02-a-s-11-14-15.png",
        },
        jas: {
          name: "Jorge Antonio Silveira",
          initials: "JA",
          targetSalesCount: 15,
          imageUrl:
            "https://i.postimg.cc/HspqGKRR/Captura-de-Tela-2025-06-02-a-s-11-53-01.png",
        },
        mc: {
          name: "Matheus Cardinal",
          initials: "MC",
          targetSalesCount: 15,
          imageUrl:
            "https://i.postimg.cc/GmMrSrpX/Captura-de-Tela-2025-06-02-a-s-11-51-43.png",
        },
        ya: {
          name: "Yvan Arruda",
          initials: "YA",
          targetSalesCount: 12,
          imageUrl:
            "https://i.postimg.cc/SQvdg9y3/Captura-de-Tela-2025-06-02-a-s-11-13-27.png",
        },
      };

      let rawSalesData = [
        { closerId: "cfn", result: 0, numberOfSales: 0, date: "2025-06-10" },
        { closerId: "ba", result: 0, numberOfSales: 0, date: "2025-06-05" },
        { closerId: "gm", result: 0, numberOfSales: 0, date: "2025-06-15" },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-06-12" },
        { closerId: "mc", result: 0, numberOfSales: 0, date: "2025-06-05" },
        { closerId: "ya", result: 0, numberOfSales: 0, date: "2025-06-10" },
        { closerId: "jas", result: 0, numberOfSales: 0, date: "2025-06-10" },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-06-18" },
        {
          closerId: "cfn",
          result: 174184.12,
          numberOfSales: 5,
          date: "2025-05-10",
        },
        {
          closerId: "ba",
          result: 35000.0,
          numberOfSales: 1,
          date: "2025-05-05",
        },
        {
          closerId: "gm",
          result: 155200.0,
          numberOfSales: 3,
          date: "2025-05-15",
        },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-05-12" },
        {
          closerId: "mc",
          result: 66000.0,
          numberOfSales: 2,
          date: "2025-05-05",
        },
        {
          closerId: "ya",
          result: 327201.27,
          numberOfSales: 9,
          date: "2025-05-10",
        },
        {
          closerId: "jas",
          result: 44000.0,
          numberOfSales: 1,
          date: "2025-05-10",
        },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-05-18" },
        {
          closerId: "cfn",
          result: 66748.0,
          numberOfSales: 2,
          date: "2025-04-10",
        },
        { closerId: "ba", result: 0, numberOfSales: 0, date: "2025-04-05" },
        {
          closerId: "gm",
          result: 258053.25,
          numberOfSales: 7,
          date: "2025-04-15",
        },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-04-12" },
        {
          closerId: "mc",
          result: 30000.0,
          numberOfSales: 1,
          date: "2025-04-05",
        },
        {
          closerId: "ya",
          result: 139930.0,
          numberOfSales: 3,
          date: "2025-04-10",
        },
        {
          closerId: "jas",
          result: 50000.0,
          numberOfSales: 1,
          date: "2025-04-10",
        },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-04-18" },
        {
          closerId: "cfn",
          result: 190295.72,
          numberOfSales: 2,
          date: "2025-03-10",
        },
        {
          closerId: "ba",
          result: 30000.0,
          numberOfSales: 1,
          date: "2025-03-05",
        },
        {
          closerId: "gm",
          result: 248230.0,
          numberOfSales: 8,
          date: "2025-03-15",
        },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-03-12" },
        {
          closerId: "mc",
          result: 243711.0,
          numberOfSales: 6,
          date: "2025-03-05",
        },
        {
          closerId: "ya",
          result: 169435.0,
          numberOfSales: 5,
          date: "2025-03-10",
        },
        {
          closerId: "jas",
          result: 110000.0,
          numberOfSales: 2,
          date: "2025-03-10",
        },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-03-18" },
        {
          closerId: "cfn",
          result: 243417.78,
          numberOfSales: 6,
          date: "2025-02-10",
        },
        {
          closerId: "ba",
          result: 31965.0,
          numberOfSales: 1,
          date: "2025-02-05",
        },
        {
          closerId: "gm",
          result: 98435.0,
          numberOfSales: 3,
          date: "2025-02-15",
        },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-02-12" },
        {
          closerId: "mc",
          result: 114580.0,
          numberOfSales: 4,
          date: "2025-02-05",
        },
        {
          closerId: "ya",
          result: 278600.0,
          numberOfSales: 7,
          date: "2025-02-10",
        },
        {
          closerId: "jas",
          result: 135000.0,
          numberOfSales: 1,
          date: "2025-02-10",
        },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-02-18" },
        {
          closerId: "cfn",
          result: 188632.75,
          numberOfSales: 4,
          date: "2025-01-10",
        },
        {
          closerId: "ba",
          result: 108435.0,
          numberOfSales: 3,
          date: "2025-01-05",
        },
        {
          closerId: "gm",
          result: 155200.0,
          numberOfSales: 3,
          date: "2025-01-15",
        },
        { closerId: "bf", result: 0, numberOfSales: 0, date: "2025-01-12" },
        {
          closerId: "mc",
          result: 64000.0,
          numberOfSales: 1,
          date: "2025-01-05",
        },
        {
          closerId: "ya",
          result: 63435.0,
          numberOfSales: 2,
          date: "2025-01-10",
        },
        {
          closerId: "jas",
          result: 500000.0,
          numberOfSales: 1,
          date: "2025-01-10",
        },
        { closerId: "ri", result: 0, numberOfSales: 0, date: "2025-01-18" },
        { closerId: "cfn", result: 0, numberOfSales: 0, date: "2024-12-01" },
        { closerId: "ba", result: 0, numberOfSales: 0, date: "2024-11-01" },
      ];

      const ANNUAL_TARGET = 30000000;
      rawSalesData = rawSalesData.filter((sale) => closersInfo[sale.closerId]);

      const monthNamesPt = [
        "Janeiro",
        "Fevereiro",
        "Março",
        "Abril",
        "Maio",
        "Junho",
        "Julho",
        "Agosto",
        "Setembro",
        "Outubro",
        "Novembro",
        "Dezembro",
      ];
      const SIMULATED_CURRENT_DATE = new Date(2025, 5, 2); // Junho é mês 5
      let monthlyTargetChartInstance = null;
      let valueAnimationId = null;

      function formatCurrency(value) {
        if (value === null || typeof value === "undefined") return "N/A";
        return value.toLocaleString("pt-BR", {
          style: "currency",
          currency: "BRL",
          minimumFractionDigits: 0,
        });
      }

      function generateMonthlyTargetChartData() {
        const annualTarget = ANNUAL_TARGET;
        const currentYear = SIMULATED_CURRENT_DATE.getFullYear();
        const labels = [];

        const monthlyTargetsData = [
          null, // Janeiro (N/A)
          null, // Fevereiro (N/A)
          null, // Março (N/A)
          null, // Abril (N/A)
          null, // Maio (N/A)
          2347877.88, // Junho
          5146040.81, // Julho
          2572194.39, // Agosto
          2929831.47, // Setembro
          4346363.61, // Outubro
          820533.55, // Novembro
          2841998.57, // Dezembro
        ];

        const actualRevenueData = [];
        const idealPaceData = [
          1479000.0, // Janeiro
          630000.0, // Fevereiro
          2270505.0, // Março
          1108068.0, // Abril
          1830000.0, // Maio
          2009565.0, // Junho
          4500034.89, // Julho
          3288150.0, // Agosto
          2667480.0, // Setembro
          3868830.0, // Outubro
          3708231.0, // Novembro
          5590257.18, // Dezembro
        ];

        let revenueAccumulatedPriorMonths = 0;
        for (let monthIndex = 0; monthIndex < 12; monthIndex++) {
          labels.push(monthNamesPt[monthIndex]);

          let revenueThisMonth = 0;
          rawSalesData.forEach((sale) => {
            const saleDate = new Date(sale.date);
            if (
              saleDate.getFullYear() === currentYear &&
              saleDate.getMonth() === monthIndex
            ) {
              revenueThisMonth += sale.result;
            }
          });
          actualRevenueData.push(revenueThisMonth);
          revenueAccumulatedPriorMonths += revenueThisMonth;
        }
        return { labels, monthlyTargetsData, actualRevenueData, idealPaceData };
      }

      function renderMonthlyTargetChart(chartData) {
        const ctx = document
          .getElementById("monthlyTargetEvolutionChart")
          .getContext("2d");
        if (monthlyTargetChartInstance) {
          monthlyTargetChartInstance.destroy();
        }
        monthlyTargetChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: chartData.labels,
            datasets: [
              {
                label: "Meta Mensal Adaptada",
                data: chartData.monthlyTargetsData,
                borderColor: "rgba(255, 159, 64, 1)",
                backgroundColor: "rgba(255, 159, 64, 0.2)",
                fill: false,
                tension: 0.1,
                pointRadius: 4,
                pointHoverRadius: 6,
                spanGaps: true,
              },
              {
                label: "Faturamento Mensal Realizado",
                data: chartData.actualRevenueData,
                borderColor: "rgba(75, 192, 192, 1)",
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                fill: false,
                tension: 0.1,
                pointRadius: 4,
                pointHoverRadius: 6,
              },
              {
                label: "Meta Ideal",
                data: chartData.idealPaceData,
                borderColor: "rgba(150, 150, 150, 0.7)",
                backgroundColor: "rgba(150, 150, 150, 0.1)",
                borderDash: [5, 5],
                fill: false,
                tension: 0.1,
                pointRadius: 2,
                pointHoverRadius: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Faturamento (R$)",
                  color: "#FFFFFF",
                  font: { size: 14 },
                },
                ticks: {
                  callback: function (value) {
                    if (value === null) return "N/A";
                    return formatCurrency(value);
                  },
                  color: "#FFFFFF",
                },
                grid: {
                  color: "rgba(255, 255, 255, 0.1)",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Mês",
                  color: "#FFFFFF",
                  font: { size: 14 },
                },
                ticks: {
                  color: "#FFFFFF",
                },
                grid: {
                  color: "rgba(255, 255, 255, 0.05)",
                },
              },
            },
            plugins: {
              legend: {
                labels: {
                  color: "#FFFFFF",
                },
              },
              tooltip: {
                backgroundColor: "rgba(0,0,0,0.8)",
                titleColor: "#FFFFFF",
                bodyColor: "var(--text-primary)",
                callbacks: {
                  label: function (context) {
                    let label = context.dataset.label || "";
                    if (label) {
                      label += ": ";
                    }
                    if (context.parsed.y !== null) {
                      label += formatCurrency(context.parsed.y);
                    } else {
                      label += "N/A";
                    }
                    return label;
                  },
                  labelTextColor: function (context) {
                    const datasetLabel = context.dataset.label;
                    if (
                      datasetLabel === "Meta Mensal Adaptada" ||
                      datasetLabel === "Faturamento Mensal Realizado" ||
                      datasetLabel === "Meta Ideal"
                    ) {
                      return "#FFFFFF";
                    }
                    return "var(--text-primary)";
                  },
                  color: function (context) {
                    const datasetLabel = context.dataset.label;
                    if (datasetLabel === "Meta Mensal Adaptada") {
                      return {
                        borderColor: "rgba(255, 159, 64, 1)",
                        backgroundColor: "rgba(255, 199, 124, 1)",
                      };
                    } else if (
                      datasetLabel === "Faturamento Mensal Realizado"
                    ) {
                      return {
                        borderColor: "rgba(75, 192, 192, 1)",
                        backgroundColor: "rgba(115, 220, 220, 1)",
                      };
                    }
                    const originalBorderColor = context.dataset.borderColor;
                    return {
                      borderColor: originalBorderColor,
                      backgroundColor: originalBorderColor,
                    };
                  },
                },
              },
            },
          },
        });
      }

      function renderEvolutionTable(chartData) {
        const tableBody = document.getElementById("evolutionTableBody");
        tableBody.innerHTML = ""; // Clear previous rows

        for (let i = 0; i < chartData.labels.length; i++) {
          const row = tableBody.insertRow();

          const cellMonth = row.insertCell();
          cellMonth.textContent = chartData.labels[i];

          const cellTarget = row.insertCell();
          cellTarget.textContent = formatCurrency(
            chartData.monthlyTargetsData[i]
          );
          cellTarget.className =
            chartData.monthlyTargetsData[i] === null ? "na-value" : "currency";

          const cellActual = row.insertCell();
          cellActual.textContent = formatCurrency(
            chartData.actualRevenueData[i]
          );
          cellActual.className = "currency";

          const cellIdeal = row.insertCell();
          cellIdeal.textContent = formatCurrency(chartData.idealPaceData[i]);
          cellIdeal.className = "currency";
        }
      }

      function populateDateFilter() {
        const filterSelect = document.getElementById("dateFilter");
        filterSelect.innerHTML = "";
        const currentYear = SIMULATED_CURRENT_DATE.getFullYear();
        const currentMonth = SIMULATED_CURRENT_DATE.getMonth();
        const currentMonthValue = `${currentYear}-${String(
          currentMonth + 1
        ).padStart(2, "0")}`;
        filterSelect.add(
          new Option(
            `Mês Atual (${monthNamesPt[currentMonth]}/${currentYear})`,
            currentMonthValue
          )
        );
        for (let m = currentMonth - 1; m >= 0; m--) {
          if (currentYear === 2025) {
            const monthValue = `${currentYear}-${String(m + 1).padStart(
              2,
              "0"
            )}`;
            filterSelect.add(
              new Option(`${monthNamesPt[m]}/${currentYear}`, monthValue)
            );
          }
        }
        filterSelect.add(new Option("Todo o Período", "all"));
        filterSelect.value = currentMonthValue;
      }

      function getProcessedData(filterValue) {
        let filteredSales = rawSalesData.filter(
          (sale) => closersInfo[sale.closerId]
        );
        if (filterValue !== "all") {
          const [year, month] = filterValue.split("-").map(Number);
          filteredSales = filteredSales.filter((sale) => {
            const saleDate = new Date(sale.date);
            return (
              saleDate.getFullYear() === year &&
              saleDate.getMonth() + 1 === month
            );
          });
        }
        const aggregatedData = {};
        for (const id in closersInfo) {
          aggregatedData[id] = {
            ...closersInfo[id],
            closerId: id,
            totalResult: 0,
            totalNumberOfSales: 0,
          };
        }
        filteredSales.forEach((sale) => {
          if (aggregatedData[sale.closerId]) {
            aggregatedData[sale.closerId].totalResult += sale.result;
            aggregatedData[sale.closerId].totalNumberOfSales +=
              sale.numberOfSales;
          }
        });
        const closersArray = Object.values(aggregatedData);
        let maxResultInPeriod = 0;
        if (closersArray.length > 0) {
          const salesPerformingClosers = closersArray.filter(
            (c) => c.totalResult > 0
          );
          if (salesPerformingClosers.length > 0) {
            maxResultInPeriod = Math.max(
              ...salesPerformingClosers.map((c) => c.totalResult)
            );
          } else {
            maxResultInPeriod = 0;
          }
        }
        return closersArray
          .map((closer) => ({
            ...closer,
            result: closer.totalResult,
            numberOfSales: closer.totalNumberOfSales,
            averageTicket:
              closer.totalNumberOfSales > 0
                ? closer.totalResult / closer.totalNumberOfSales
                : 0,
            percentage:
              maxResultInPeriod > 0
                ? Math.round((closer.totalResult / maxResultInPeriod) * 100)
                : 0,
          }))
          .sort((a, b) => {
            if (b.result !== a.result) {
              return b.result - a.result;
            }
            if (b.numberOfSales !== a.numberOfSales) {
              return b.numberOfSales - a.numberOfSales;
            }
            return a.name.localeCompare(b.name);
          });
      }

      function generatePodium(data) {
        const container = document.getElementById("podium-container");
        container.innerHTML = "";
        const podiumTitle = document.querySelector(
          ".podium-section .podium-title"
        );
        const salesPerformers = data.filter((closer) => closer.result > 0);
        if (salesPerformers.length === 0) {
          podiumTitle.textContent =
            "Pódio de Vendas (Sem dados para o período)";
          container.innerHTML = `<p class="empty-data-message">Nenhum dado de vendas para o período selecionado.</p>`;
          return;
        }
        podiumTitle.textContent = "Pódio de Vendas";
        const topThree = salesPerformers.slice(0, 3);
        const createPodiumElement = (closerData, placeClass, rankText) => {
          if (!closerData) return null;
          const podiumItem = document.createElement("div");
          podiumItem.className = `podium-item ${placeClass}`;
          podiumItem.innerHTML = `<div class="podium-closer-photo"><img src="${
            closerData.imageUrl
          }" alt="Foto de ${
            closerData.name
          }" /></div> <div class="rank">${rankText}</div><div class="name">${
            closerData.name
          }</div><div class="sales">${formatCurrency(closerData.result)}</div>`;
          return podiumItem;
        };
        let item2nd = null,
          item1st = null,
          item3rd = null;
        if (topThree[0]) {
          item1st = createPodiumElement(topThree[0], "first", "1º");
        }
        if (topThree[1]) {
          item2nd = createPodiumElement(topThree[1], "second", "2º");
        }
        if (topThree[2]) {
          item3rd = createPodiumElement(topThree[2], "third", "3º");
        }
        if (item2nd) container.appendChild(item2nd);
        if (item1st) container.appendChild(item1st);
        if (item3rd) container.appendChild(item3rd);
      }

      function generateRanking(data) {
        const container = document.getElementById("ranking-container");
        container.innerHTML = "";
        if (!data || data.length === 0) {
          container.innerHTML = `<p class="empty-data-message">Nenhum closer no ranking para o período selecionado.</p>`;
          return;
        }
        let displayRankCounter = 0;
        let previousResult = -Infinity;
        let previousSalesCount = -Infinity;
        const closersWithRank = data.map((closer, index) => {
          if (
            closer.result !== previousResult ||
            closer.numberOfSales !== previousSalesCount
          ) {
            displayRankCounter = index + 1;
          }
          previousResult = closer.result;
          previousSalesCount = closer.numberOfSales;
          return { ...closer, displayRank: displayRankCounter };
        });
        closersWithRank.forEach((closer) => {
          const isTop1 = closer.displayRank === 1 && closer.result > 0;
          const rankingItem = document.createElement("div");
          rankingItem.className = `ranking-item ${isTop1 ? "top-1" : ""}`;
          rankingItem.innerHTML = `<div class="ranking-position">${
            closer.displayRank
          }</div><div class="closer-photo"><img src="${
            closer.imageUrl
          }" alt="Foto de ${
            closer.name
          }" /></div><div class="closer-info"><div class="closer-name">${
            closer.name
          }</div><div class="progress-wrapper"><div class="progress-container"><div class="progress-bar" style="width: ${Math.min(
            closer.percentage,
            100
          )}%"></div></div><span class="percentage">${
            closer.percentage
          }%</span></div></div>`;
          container.appendChild(rankingItem);
        });
      }

      function populateDropdown(data) {
        const select = document.getElementById("closerSelect");
        select.innerHTML = '<option value="">Selecione um closer</option>';
        const noIndividualDataMsg = document.getElementById(
          "noIndividualDataMessage"
        );
        const selectedCloserInfoDiv =
          document.getElementById("selectedCloserInfo");
        if (!data || data.length === 0) {
          selectedCloserInfoDiv.style.display = "none";
          noIndividualDataMsg.textContent = "Nenhum closer cadastrado.";
          noIndividualDataMsg.style.display = "block";
          return;
        }
        noIndividualDataMsg.style.display = "none";
        const sortedDataForDropdown = [...data].sort((a, b) =>
          a.name.localeCompare(b.name)
        );
        sortedDataForDropdown.forEach((closer) => {
          const option = document.createElement("option");
          option.value = closer.closerId;
          option.textContent = closer.name;
          select.appendChild(option);
        });
      }

      function updateIndividualView(closerId, dataForPeriod) {
        const closer = dataForPeriod.find((c) => c.closerId === closerId);
        const infoDiv = document.getElementById("selectedCloserInfo");
        const photoDiv = document.getElementById("selectedPhoto");
        const noDataMsg = document.getElementById("noIndividualDataMessage");

        if (valueAnimationId) {
          cancelAnimationFrame(valueAnimationId);
          valueAnimationId = null;
        }

        if (!closer) {
          infoDiv.style.display = "none";
          noDataMsg.textContent =
            "Dados não encontrados para este closer no período selecionado.";
          noDataMsg.style.display = "block";
          document.getElementById("individualPerformanceValue").textContent =
            formatCurrency(0);
          return;
        }

        noDataMsg.style.display = "none";
        infoDiv.style.display = "flex";
        photoDiv.innerHTML = `<img src="${closer.imageUrl}" alt="Foto de ${closer.name}" />`;
        document.getElementById("selectedName").textContent = closer.name;
        document.getElementById("currentResult").textContent = formatCurrency(
          closer.result
        );
        document.getElementById("salesCountValue").textContent =
          closer.numberOfSales;
        document.getElementById("averageTicketValue").textContent =
          formatCurrency(closer.averageTicket);

        const top1Performer =
          dataForPeriod.length > 0 && dataForPeriod[0].result > 0
            ? dataForPeriod[0]
            : null;
        const top1Result = top1Performer ? top1Performer.result : 0;
        const selectedCloserResult = closer.result;

        let progressRatio = 0;
        if (top1Result > 0) {
          progressRatio = selectedCloserResult / top1Result;
        } else if (selectedCloserResult > 0) {
          progressRatio = 1;
        }
        progressRatio = Math.min(Math.max(progressRatio, 0), 1);

        const circleFill = document.getElementById(
          "individualPerformanceCircleFill"
        );
        const radius = parseFloat(circleFill.getAttribute("r"));
        const circumference = 2 * Math.PI * radius;
        const offset = circumference * (1 - progressRatio);

        circleFill.style.strokeDasharray = circumference;
        requestAnimationFrame(() => {
          circleFill.style.strokeDashoffset = offset;
        });

        const valueElement = document.getElementById(
          "individualPerformanceValue"
        );
        const animationDuration = 1500;
        let startTimestamp = null;
        const startValue = 0;
        const endValue = selectedCloserResult;

        function step(timestamp) {
          if (!startTimestamp) startTimestamp = timestamp;
          const elapsedTime = timestamp - startTimestamp;
          const progress = Math.min(elapsedTime / animationDuration, 1);
          const currentValue = startValue + (endValue - startValue) * progress;

          valueElement.textContent = formatCurrency(currentValue);

          if (progress < 1) {
            valueAnimationId = requestAnimationFrame(step);
          } else {
            valueElement.textContent = formatCurrency(endValue);
            valueAnimationId = null;
          }
        }
        valueAnimationId = requestAnimationFrame(step);

        let labelText = "Faturamento";
        if (
          selectedCloserResult === 0 &&
          (!top1Performer || top1Result === 0)
        ) {
          labelText = "Sem faturamento";
        } else if (top1Performer) {
          if (closer.closerId === top1Performer.closerId) {
            labelText = "Top 1 Performance";
          } else {
            labelText = `de ${formatCurrency(top1Result)} (Top 1)`;
          }
        } else if (selectedCloserResult > 0) {
          labelText = "Único com Faturamento";
        }
        document.getElementById("individualPerformanceLabel").textContent =
          labelText;
      }

      function clearIndividualView() {
        if (valueAnimationId) {
          cancelAnimationFrame(valueAnimationId);
          valueAnimationId = null;
        }

        document.getElementById("selectedCloserInfo").style.display = "none";
        document.getElementById("noIndividualDataMessage").style.display =
          "block";
        document.getElementById("noIndividualDataMessage").textContent =
          "Selecione um closer para ver os detalhes.";
        document.getElementById("closerSelect").value = "";

        const circleFill = document.getElementById(
          "individualPerformanceCircleFill"
        );
        if (circleFill) {
          const radius = parseFloat(circleFill.getAttribute("r"));
          const circumference = 2 * Math.PI * radius;
          circleFill.style.transition = "none";
          circleFill.style.strokeDashoffset = circumference;
          circleFill.offsetHeight;
          circleFill.style.transition =
            "stroke-dashoffset 1.5s cubic-bezier(0.42, 0, 0.58, 1)";
        }
        const valueText = document.getElementById("individualPerformanceValue");
        if (valueText) valueText.textContent = formatCurrency(0);
        const labelText = document.getElementById("individualPerformanceLabel");
        if (labelText) labelText.textContent = "Faturamento";

        const selectedPhotoDiv = document.getElementById("selectedPhoto");
        if (selectedPhotoDiv) selectedPhotoDiv.innerHTML = "";
        const selectedNameDiv = document.getElementById("selectedName");
        if (selectedNameDiv) selectedNameDiv.textContent = "";

        const currentResultDiv = document.getElementById("currentResult");
        if (currentResultDiv) currentResultDiv.textContent = formatCurrency(0);
        const salesCountValueDiv = document.getElementById("salesCountValue");
        if (salesCountValueDiv) salesCountValueDiv.textContent = "0";
        const averageTicketValueDiv =
          document.getElementById("averageTicketValue");
        if (averageTicketValueDiv)
          averageTicketValueDiv.textContent = formatCurrency(0);
      }

      function refreshDashboard() {
        const filterValue = document.getElementById("dateFilter").value;
        const currentProcessedData = getProcessedData(filterValue);

        const evolutionChartData = generateMonthlyTargetChartData();
        renderMonthlyTargetChart(evolutionChartData);
        renderEvolutionTable(evolutionChartData); // Call the new function here

        generatePodium(currentProcessedData);
        generateRanking(currentProcessedData);
        populateDropdown(currentProcessedData);
        const selectedCloserId = document.getElementById("closerSelect").value;
        if (
          selectedCloserId &&
          currentProcessedData.find((c) => c.closerId === selectedCloserId)
        ) {
          updateIndividualView(selectedCloserId, currentProcessedData);
        } else {
          clearIndividualView();
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        populateDateFilter();
        refreshDashboard();

        document
          .getElementById("dateFilter")
          .addEventListener("change", refreshDashboard);
        document
          .getElementById("closerSelect")
          .addEventListener("change", function () {
            const selectedCloserId = this.value;
            const filterValue = document.getElementById("dateFilter").value;
            const currentProcessedData = getProcessedData(filterValue);
            if (selectedCloserId) {
              updateIndividualView(selectedCloserId, currentProcessedData);
            } else {
              clearIndividualView();
            }
          });
      });
    </script>
  </body>
</html>
